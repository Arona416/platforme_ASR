<!-- templates/index.html -->
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Inscription — Association des Sénégalais de Russie</title>
  <link rel="stylesheet" href="/static/style.css">
  <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
  <div class="container">
    <h1>Inscription pour intégration aux groupes WhatsApp</h1>
    <p>Merci de remplir ce formulaire. Vos données serviront uniquement à vérifier et vous ajouter dans nos groupes.</p>

    <form id="formInscription">
      <label>Nom complet</label>
      <input type="text" name="full_name" required>

      <label>Ville en Russie</label>
      <input type="text" name="city_russia" required>

      <label>Ville au Sénégal</label>
      <input type="text" name="city_senegal" required>

      <label>Numéro de téléphone (WhatsApp si possible)</label>
      <input type="text" name="phone" placeholder="+7 9xx xxx xxxx" required>

      <label>Contact d'urgence (nom + numéro)</label>
      <input type="text" name="emergency_contact" required>

      <label class="consent">
        <input type="checkbox" name="consent" required>
        J'autorise l'association à conserver ces informations pour les besoins d'ajout aux groupes et pour un éventuel recensement.
      </label>

      <button type="submit">Envoyer la demande</button>
    </form>

    <p id="result"></p>
  </div>

<script>
document.getElementById("formInscription").addEventListener("submit", async function(e){
  e.preventDefault();
  const form = e.currentTarget;
  const data = {};
  new FormData(form).forEach((v,k) => { if(k !== 'consent') data[k] = v; }); // on n'envoie pas la checkbox elle-même

  // envoi JSON
  try {
    const resp = await fetch("/envoyer", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await resp.json();
    if(resp.ok && json.status === "success"){
      document.getElementById("result").innerText = json.message;
      form.reset();
    } else {
      document.getElementById("result").innerText = (json && json.message) ? json.message : "Erreur lors de l'envoi.";
    }
  } catch (err){
    document.getElementById("result").innerText = "Erreur réseau : " + err;
  }
});
</script>
</body>
</html>
